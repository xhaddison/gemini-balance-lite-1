### **用户手册: 智能密钥调度器异常处理指南**

欢迎使用我们的智能 API 服务。为了向您提供不间断的稳定体验，系统内置了一套强大的“智能密钥调度器”，它可以自动化地处理各种 API 密钥相关的异常情况。您无需进行任何手动干预，以下是其工作原理的说明：

**核心理念: 自动化与弹性**

调度器的核心设计理念是：让系统足够“聪明”，能够自己诊断问题、解决问题，从而最大化服务的稳定性和弹性。它主要处理两种类型的错误：客户端错误和服务器端错误。

**1. 如何处理客户端错误 (如：密钥无效、权限不足)？**

这类错误通常以 `40x` 的代码形式出现，例如 `403 Forbidden`。它们意味着 API 密钥本身存在根本性问题，是**永久性**的。

*   **自动诊断:** 当系统检测到某个密钥返回 `40x` 错误时，会立刻识别出这是一个永久性问题。
*   **自动隔离:** 该密钥会被立即标记为 **“永久失效”**。
*   **永久移除:** 系统会将其从当前可用的密钥池中彻底移除，确保未来的所有请求都不会再尝试使用这个无效密钥。

> **对您意味着什么？**
> 您无需担心因某个密钥配置错误或被吊销而导致整个服务中断。系统会自动“清理门户”，确保只有健康的密钥在工作。

**2. 如何处理服务器端错误 (如：服务临时不可用)？**

这类错误通常以 `50x` 的代码形式出现，例如 `500 Internal Server Error`。它们通常表示 Gemini 的服务器暂时遇到了问题，是**临时性**的，并且很可能在短时间内恢复。

*   **智能重试:** 当遇到 `50x` 错误时，系统不会立即放弃。它会认为这只是一个网络“小抖动”，并使用**同一个密钥**自动进行几次短暂的重试。
*   **熔断与冷却:** 如果连续重试后依然失败，系统会启动熔断机制，判断该密钥所连接的服务器节点可能暂时存在问题。
    *   此时，该密钥会被置于 **“冷却”** 状态，并被暂时移出服务队列。
    *   这就像是让它“休息一下”，避免在服务不稳定的情况下对其进行无效的请求轰炸。
*   **自动恢复:** 经过一段预设的冷却时间（例如5分钟）后，系统会认为服务可能已经恢复，于是会自动将该密钥重新激活，并将其放回工作队列中，让它重新开始处理请求。

> **对您意味着什么？**
> 面对服务端的临时故障，我们的系统具备强大的容错和自愈能力。它通过“重试”来应对瞬时问题，通过“熔断冷却”来应对持续性问题，极大地减少了因外部服务不稳定对您造成的影响。